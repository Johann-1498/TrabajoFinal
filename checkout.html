<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>D`Jar Supermarket - Verificar</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content name="keywords">
    <meta content name="description">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap"
        rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
</head>

<body>

    <!-- Spinner Start -->
    <div id="spinner"
        class="show w-100 vh-100 bg-white position-fixed translate-middle top-50 start-50  d-flex align-items-center justify-content-center">
        <div class="spinner-grow text-primary" role="status"></div>
    </div>
    <!-- Spinner End -->

    <!-- Navbar start -->
    <div class="container-fluid fixed-top">
        <div class="container px-0">
            <nav class="navbar navbar-light bg-white navbar-expand-xl">
                <a href="index.html" class="navbar-brand">
                    <h1 class="text-primary display-6">D`Jar</h1>
                </a>
                <button class="navbar-toggler py-2 px-3" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarCollapse">
                    <span class="fa fa-bars text-primary"></span>
                </button>
                <div class="collapse navbar-collapse bg-white" id="navbarCollapse">
                    <div class="navbar-nav mx-auto">
                        <a href="index.html" class="nav-item nav-link">Inicio</a>
                        <div class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Paginas</a>
                            <div class="dropdown-menu m-0 bg-secondary rounded-0">
                                <a href="cart.html" class="dropdown-item">Carro</a>
                                <a href="checkout.html" class="dropdown-item">Caja</a>
                                <a href="404.html" class="dropdown-item">404
                                    Page</a>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex m-3 me-0">
                        <a id="cartButton" href="cart.html" class="position-relative me-4 my-auto">
                            <i class="fa fa-shopping-bag fa-2x"></i>
                            <span id="carritoNum"
                                class="position-absolute bg-secondary rounded-circle d-flex align-items-center justify-content-center text-dark px-1"
                                style="top: -5px; left: 15px; height: 20px; min-width: 20px;">0</span>
                        </a>
                        <a id="perfilButton" href="./miPerfil.html" class="my-auto">
                            <i class="fas fa-user fa-2x"></i>
                        </a>
                    </div>
                    <button id="closeSession" class="button-S-IoR">Salir</button>
                </div>
            </nav>
        </div>
    </div>
    <!-- Navbar End -->
    <!-- Single Page Header start -->
    <div class="container-fluid page-header py-5">
        <h1 class="text-center text-white display-6">Caja</h1>
        <ol class="breadcrumb justify-content-center mb-0">
            <li class="breadcrumb-item"><a href="index.html">Inicio</a></li>
            <li class="breadcrumb-item active text-white">Caja</li>
        </ol>
    </div>
    <!-- Single Page Header End -->

    <!-- Checkout Page Start -->
    <div class="container-fluid py-5">
        <div class="container py-5">
            <h1 class="mb-4">Detalles de facturaci√≥n</h1>
            <form id="infoForm" action="#">
                <div class="row g-5">
                    <div class="col-md-12 col-lg-6 col-xl-7">
                        <div class="form-item">
                            <div class="form-item w-100">
                                <label class="form-label my-3">Nombre<sup>*</sup></label>
                                <input name="name" type="text" class="form-control" id="contName">
                            </div>
                        </div>
                        <div class="form-item">
                            <label class="form-label my-3">Direccion
                                <sup>*</sup></label>
                            <input name="direccion" type="text" class="form-control" id="contAddress">
                        </div>
                        <div class="form-item">
                            <label class="form-label my-3">Telefono<sup>*</sup></label>
                            <input name="phone" type="tel" class="form-control" id="contPhone">
                        </div>
                        <div class="form-item">
                            <label class="form-label my-3">Correo<sup>*</sup></label>
                            <input name="email" type="email" class="form-control" id="contEmail">
                        </div>
                        <hr>

                        <div class="form-item">
                            <textarea id="notasPedido" name="text" class="form-control" spellcheck="false" cols="30"
                                rows="11" placeholder="Notas de pedido (opcional)"></textarea>
                        </div>
                    </div>
                    <div class="col-md-12 col-lg-6 col-xl-5">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">Productos</th>
                                        <th scope="col">Nombre</th>
                                        <th scope="col">Precio</th>
                                        <th scope="col">Cantidad</th>
                                        <th scope="col">Total</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    <tr>
                                        <th scope="row">
                                        </th>
                                        <td class="py-5">
                                            <p class="mb-0 text-dark py-3">Subtotal</p>
                                        </td>
                                        <td class="py-5"></td>
                                        <td class="py-5"></td>
                                        <td class="py-5">
                                            <div class="py-3 border-bottom border-top">
                                                <p class="subTotal mb-0 text-dark">$414.00</p>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">
                                        </th>
                                        <td class="py-5">
                                            <p class="mb-0 text-dark py-4">Envio</p>
                                        </td>
                                        <td class="py-5"></td>
                                        <td class="py-5"></td>
                                        <td colspan="3" class="py-5">
                                            <div class="py-3 border-bottom border-top">
                                                <p class="mb-0 text-dark">S/.
                                                    3.00</p>
                                            </div>

                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">
                                        </th>
                                        <td class="py-5">
                                            <p class="mb-0 text-dark text-uppercase py-3">TOTAL</p>
                                        </td>
                                        <td class="py-5"></td>
                                        <td class="py-5"></td>
                                        <td class="py-5">
                                            <div class="py-3 border-bottom border-top">
                                                <p class="finalPrice mb-0 text-dark">$135.00</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="row g-4 text-center align-items-center justify-content-center border-bottom py-3">
                            <div class="col-12">
                                <div class="form-check text-start my-3">
                                    <input type="checkbox" class="form-check-input bg-primary border-0" id="Transfer-1"
                                        name="Transfer" value="Transfer">
                                    <label class="form-check-label" for="Transfer-1">Pago con
                                        Tarjeta</label>
                                </div>
                                <p class="text-start text-dark">Realice su
                                    pago usando la tarjeta registrada en su
                                    cuenta</p>
                            </div>
                        </div>
                        <div class="row g-4 text-center align-items-center justify-content-center pt-4">
                            <button type="button"
                                class="btnRealizarPedido btn border-secondary py-3 px-4 text-uppercase w-100 text-primary">Realizar
                                pedido</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- Checkout Page End -->

    <!-- Footer Start -->
    <div class="container-fluid bg-dark text-white-50 footer pt-5 mt-5">
        <div class="container py-5">
            <div class="pb-4 mb-4" style="border-bottom: 1px solid rgba(226, 175, 24, 0.5) ;">
                <div class="row g-4">
                    <div class="col-lg-3">
                        <a href="#">
                            <h1 class="text-primary mb-0">D`Jar</h1>
                            <p class="text-secondary mb-0">Productos de
                                calidad</p>
                        </a>
                    </div>
                    <div class="col-lg-6">
                    </div>
                    <div class="col-lg-3">
                        <div class="d-flex justify-content-end pt-3">
                            <a class="btn  btn-outline-secondary me-2 btn-md-square rounded-circle"
                                href="https://twitter.com/jar_market73997 "><i class="fab fa-twitter"></i></a>
                            <a class="btn btn-outline-secondary me-2 btn-md-square rounded-circle"
                                href="https://www.facebook.com/profile.php?id=61556158175069&is_tour_dismissed=true"><i
                                    class="fab fa-facebook-f"></i></a>
                            <a class="btn btn-outline-secondary me-2 btn-md-square rounded-circle"
                                href="https://www.youtube.com/channel/UCo1igwx2UxEm4zMX4vm2gEQ"><i
                                    class="fab fa-youtube"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row g-5">
                <div class="col-lg-3 col-md-6">
                    <div class="footer-item">
                        <h4 class="text-light mb-3">¬°Por qu√© a la gente le
                            gustamos!</h4>
                        <p class="mb-4">Trabajando para ustedes desde 1998,
                            su tienda de confianza.</p>
                        <a href class="btn border-secondary py-2 px-4 rounded-pill text-primary">Leer
                            m√°s</a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="d-flex flex-column text-start footer-item">
                        <h4 class="text-light mb-3">Informaci√≥n de la
                            tienda</h4>
                        <a class="btn-link" href>Sobre nosotros</a>
                        <a class="btn-link" href>Contacta con nosotros </a>
                        <a class="btn-link" href>Pol√≠tica de privacidad</a>
                        <a class="btn-link" href>Terminos y condiciones</a>
                        <a class="btn-link" href>Pol√≠tica de
                            devoluciones</a>
                        <a class="btn-link" href>Preguntas frecuentes y
                            ayuda</a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="d-flex flex-column text-start footer-item">
                        <h4 class="text-light mb-3">Cuenta</h4>
                        <a class="btn-link" href>Mi cuenta</a>
                        <a class="btn-link" href>Detalles de la tienda</a>
                        <a class="btn-link" href>Carro de la compra</a>
                        <a class="btn-link" href>Lista de deseos</a>
                        <a class="btn-link" href>Historial de pedidos</a>
                        <a class="btn-link" href>Pedidos Internacionales</a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="footer-item">
                        <h4 class="text-light mb-3">Contact</h4>
                        <p>Direccion: Av. Independencia S/N o Calle Moral
                            316 ‚Äì Cercado</p>
                        <p>Correo: johanncaceres@gmail.com</p>
                        <p>Telefono: +51-923-212-867</p>
                        <p>Tipos de pagos</p>
                        <img src="img/payment.png" class="img-fluid" alt>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->

    <!-- Copyright Start -->
    <div class="container-fluid copyright bg-dark py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    <span class="text-light"><a href="#"><i class="fas fa-copyright text-light me-2"></i>D`Jar</a>,
                        Todo
                        derecho reservado.</span>
                </div>

            </div>
        </div>
    </div>
    <!-- Copyright End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-primary border-3 border-primary rounded-circle back-to-top"><i
            class="fa fa-arrow-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Template Javascript -->
    <!-- <script src="js/validateSession.js"></script> -->
    <script src="js/validateSession.js"></script>
    <script type="module" src="js/main.js"></script>
    <script>
        ifPageIsNecesaryValidate();
        class trDetail {
            constructor(name, img, price, quantity) {
                this.name = name;
                this.img = img;
                this.price = price;
                this.quantity = quantity;
                this.total = (price * quantity).toFixed(2);
            };
            getHmtlObject() {
                let htmlObject = document.createElement("tr");
                htmlObject.innerHTML = `<th scope="row">
                                            <div class="d-flex align-items-center mt-2">
                                                <img src="${this.img}" class="img-fluid rounded-circle"
                                                    style="width: 90px; height: 90px;" alt="">
                                            </div>
                                        </th>
                                        <td class="py-5">${this.name}</td>
                                        <td class="py-5">S/. ${this.price}</td>
                                        <td class="py-5">${this.quantity}</td>
                                        <td class="total py-5">S/. ${this.total}</td>`;
                return htmlObject;
            }
        }
        let tBody = document.querySelector("tbody");
        let tBodyFirstChild = tBody.firstChild;
        let carritoInfo = {};
        let carritoJsonString = JSON.stringify(carritoInfo);
        fetch("cgi-bin/obtenerDatosDeTarjeta.pl?userID=" + userID).then(response => response.json()).then((cardData) => {
            localStorage.setItem("Payment", JSON.stringify(cardData));
        })
        fetch("cgi-bin/obtenerDatosdeCarrito.pl?token=" + obtenerTokenDeSesion()).then(response => response.json()).then((data) => {
            carritoInfo = JSON.parse(data.content);
            carritoJsonString = JSON.stringify(carritoInfo);
            console.log(carritoInfo);
            let productosKey = Object.keys(carritoInfo);
            for (let i = 0; i < productosKey.length; i++) {
                let element = carritoInfo[productosKey[i]];
                let trElement = new trDetail(productosKey[i], element.imgSrc, element.price, element.amount).getHmtlObject();
                tBody.insertBefore(trElement, tBodyFirstChild)
            }
            let totalPriceint = 0;
            let totalPrice = document.querySelectorAll(".total");
            totalPrice.forEach(value => totalPriceint += +value.textContent.substring(4))
            console.log(totalPriceint);
            let subTotal = document.querySelector(".subTotal");
            let finalPrice = document.querySelector(".finalPrice");
            subTotal.textContent = "S/. " + totalPriceint.toFixed(2);
            finalPrice.textContent = "S/. " + (totalPriceint + 3).toFixed(2);
            document.querySelector(".btnRealizarPedido").addEventListener("click", () => {
                let form = new FormData(document.querySelector("#infoForm"));
                form.append("detalles", notasPedidoElement.value);
                form.append("productos", carritoJsonString);
                form.append("clientID", datosUser.id);
                form.append("paymentID", 123);
                fetch("cgi-bin/ventas.pl", {
                    method: 'POST',
                    body: form
                }).then(response => response.json()).then(data => console.log(data));
            });
            let datosUser = JSON.parse(localStorage.getItem("User"));
            var contNameElement = document.getElementById('contName');
            var contPhoneElement = document.getElementById('contPhone');
            var contEmailElement = document.getElementById('contEmail');
            var contAddressElement = document.getElementById('contAddress');
            var notasPedidoElement = document.getElementById('notasPedido');
            contNameElement.value = datosUser.name;
            contPhoneElement.value = datosUser.phone;
            contEmailElement.value = datosUser.email;
            contAddressElement.value = datosUser.direccion;
        });





    </script>
</body>

</html>