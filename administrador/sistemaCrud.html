<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css'
            rel='stylesheet'>
        <link rel="stylesheet" href="../css/sistemaCrud.css">

        <title>Document</title>
    </head>

    <body>
        <header>
            <img src="i../mg/celtic_6043595.png" alt height="70px">
            <h1>Supermercado XYZ</h1>
        </header>
        <nav>
            <a href="../index.html">Inicio</a>
            <a href="../clientes.html">Cat√°logos de ofertas</a>
            <a href="../tarjetas.html">Nuestras ofertas</a>
            <a href="../cuentas.html">Productos</a>
            <a href='../miPerfil.html'>Mi Perfil</a>

        </nav>

        <main>
            <div class="content">
                <table border="1">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Password</th>
                            <th>Phone</th>
                            <th>CUI</th>
                            <th>TokenSesion/th>
                            </tr>
                        </thead>
                        <tbody id="tabla">
                        </tbody>
                    </table>
                </div>

            </main>

            <button id="closeSession">XDDD</button>

            <footer>
                <p>&copy; 2024 Supermercado XYZ</p>
            </footer>
            <script src="../js/validateSession.js"></script>
            <script>
            class trUser {
                    constructor(id,name,email,password,phone,cui,tokenSesion) {
                        this.id = id;
                        this.name = name;
                        this.email = email;
                        this.password = password;
                        this.phone = phone;
                        this.cui = cui;
                        this.tokenSesion = tokenSesion;
                    }
                    getTrHtmlObject(){
                        let htmlObject = document.createElement("tr");
                        let tdId = document.createElement("td");
                        tdId.textContent = this.id;
                        let tdName = document.createElement("td");
                        tdName.textContent = this.name;
                        let tdEmail = document.createElement("td");
                        tdEmail.textContent = this.email;
                        let tdPassword = document.createElement("td");
                        tdPassword.textContent = this.password;
                        let tdPhone= document.createElement("td");
                        tdPhone.textContent = this.phone;
                        let tdCui = document.createElement("td");
                        tdCui.textContent = this.cui;
                        let tdTokenSesion = document.createElement("td");
                        tdTokenSesion.textContent =  this.tokenSesion;
                        htmlObject.append(tdId, tdName, tdEmail, tdPassword, tdPhone, tdTokenSesion);
                        return htmlObject;
                    }
                }
        fetch("../cgi-bin/sistemaCrud.pl?token=" + obtenerTokenDeSesion())
        .then(response => response.json())
        .then((data) =>{
            let tabla = document.querySelector("#tabla");
            let users = [];
            let user;
            for(let index in data){
                valor = data[index];
                for(let json in valor){
                    user = new User(json[id], json[name], json[email], json[password], json[phone], json[cui], json[tokenSesion]);
                    users.push(user);
                    tabla.append(user.getTrHtmlObject());
                    
                }
        }});

        </script>
        </body>

    </html>